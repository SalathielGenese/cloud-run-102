#!/usr/bin/env sh
set -ex

REGION="${2:-us-central1}"
SERVICE="${1:-cloud-run-102}"
DOMAIN="${SERVICE}.macrocephal.cloud"
PROJECT="${3:-salathielgenese-playground}"

./build "${SERVICE}"
gcloud beta run deploy \
    "${SERVICE}" \
    --region "${REGION}" \
    --image "gcr.io/${PROJECT}/${SERVICE}"

gcloud beta run domain-mappings describe \
    --region "${REGION}" \
    --domain "${DOMAIN}" ||
    gcloud beta run domain-mappings create \
        --region "${REGION}" \
        --domain "${DOMAIN}" \
        --service "${SERVICE}"
